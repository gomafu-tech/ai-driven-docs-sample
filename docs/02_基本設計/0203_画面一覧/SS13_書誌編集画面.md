# SS13: 書誌編集画面

**アクセス方法**: 書誌検索画面（管理） → 編集ボタン / 書誌詳細画面 → 編集ボタン  
**関連業務フロー**: 蔵書管理

## 主要機能
1. **書誌情報更新**: 既存書誌情報の編集・更新
2. **データ検証**: 入力内容の整合性チェック
3. **外部連携**: 外部データベースとの同期更新
4. **変更履歴**: 更新内容の履歴記録

## 入力項目

### 基本書誌情報
| 項目名 | 項目定義 | 必須 | 追加制約 | 備考 |
|--------|----------|----|---------|----- |
| ISBN | 文字列 | - | ISBN-13形式 | 978-xxxxxxxxx |
| 書名 | 文字列 | ● | 最大200文字 | |
| 副書名 | 文字列 | - | 最大100文字 | |
| 著者名 | 文字列 | ● | 最大100文字 | |
| 出版社 | 文字列 | ● | 最大50文字 | |
| 出版年 | 数値 | ● | 1900-現在年 | |
| 版情報 | 文字列 | - | 最大20文字 | 第2版等 |

### 詳細情報
| 項目名 | 項目定義 | 必須 | 追加制約 | 備考 |
|--------|----------|----|---------|----- |
| シリーズ名 | 文字列 | - | 最大100文字 | |
| 巻号 | 文字列 | - | 最大20文字 | |
| ページ数 | 数値 | - | 1-9999 | |
| サイズ | 文字列 | - | 最大20文字 | A5判等 |
| 価格 | 数値 | - | 0-999999 | 円単位 |

### 分類情報
| 項目名 | 項目定義 | 必須 | 追加制約 | 備考 |
|--------|----------|----|---------|----- |
| NDC分類 | 文字列 | ● | NDC形式 | 3桁の数値 |
| 件名 | 文字列 | - | 最大100文字 | |
| 内容注記 | [長文テキスト](02_基本設計/0202_項目定義一覧/項目定義一覧.md#長文テキスト) | - | - | |

### システム情報
| 項目名 | 項目定義 | 必須 | 追加制約 | 備考 |
|--------|----------|----|---------|----- |
| 資料区分 | 選択 | ● | 図書/雑誌/視聴覚 | |
| 利用区分 | 選択 | ● | 館内/貸出可/禁帯出 | |
| 対象年齢 | 選択 | - | 一般/児童/青少年 | |

## 表示項目

### 現在の情報
| 項目名 | 表示内容 | 備考 |
|--------|----------|------|
| 書誌ID | 書誌識別番号 | 変更不可 |
| 登録日 | 初回登録日 | 変更不可 |
| 最終更新日 | 最後の変更日時 | 変更不可 |
| 更新者 | 最後に更新したスタッフ | 変更不可 |

### 蔵書情報
| 項目名 | 表示内容 | 備考 |
|--------|----------|------|
| 蔵書数 | 紐づく蔵書の総数 | リンク（蔵書一覧へ） |
| 貸出中数 | 現在貸出中の冊数 | |
| 予約数 | 現在の予約件数 | |

### 外部連携情報
| 項目名 | 表示内容 | 備考 |
|--------|----------|------|
| 外部DB連携状態 | 連携済み/未連携/エラー | |
| 最終同期日時 | YYYY/MM/DD HH:MM | |

## 操作機能

### 基本操作
- **更新実行**: 入力内容での書誌情報更新
- **キャンセル**: 変更を破棄して前画面に戻る
- **プレビュー**: 更新後の表示確認
- **一時保存**: 入力途中での一時保存

### 入力支援
- **ISBN検索**: 外部データベースからの情報取得
- **分類検索**: NDC分類の検索・選択
- **重複チェック**: 類似書誌の確認
- **データ検証**: 入力内容の整合性チェック

### 管理操作
- **変更履歴表示**: 過去の更新履歴確認
- **外部同期**: 外部データベースとの同期
- **蔵書一覧**: 紐づく蔵書の一覧表示
- **削除**: 書誌情報の削除（蔵書なしの場合）

## エラーハンドリング

### 入力エラー
| エラー種別 | 表示メッセージ | 対応 |
|-----------|---------------|-----|
| 必須入力エラー | 「{項目名}を入力してください」 | 該当項目をハイライト |
| フォーマットエラー | 「正しい形式で入力してください」 | 入力欄をハイライト |
| 文字数超過 | 「{項目名}は{X}文字以内で入力してください」 | 文字数表示 |
| 数値範囲エラー | 「{項目名}は{X}～{Y}の範囲で入力してください」 | 範囲表示 |

### 業務エラー
| エラー種別 | 表示メッセージ | 対応 |
|-----------|---------------|-----|
| 重複書誌 | 「類似の書誌情報が既に存在します」 | 類似書誌表示 |
| ISBN重複 | 「このISBNは既に他の書誌で使用されています」 | 既存書誌へのリンク |
| 蔵書存在時削除不可 | 「蔵書が存在するため削除できません」 | 蔵書処理促す |
| 貸出中更新制限 | 「貸出中の資料があるため一部項目は変更できません」 | 制限項目表示 |

### 外部連携エラー
| エラー種別 | 表示メッセージ | 対応 |
|-----------|---------------|-----|
| ISBN検索失敗 | 「外部データベースの検索に失敗しました」 | 手動入力促す |
| 同期エラー | 「外部データベースとの同期に失敗しました」 | 再試行促す |
| ネットワークエラー | 「外部データベースに接続できません」 | 接続確認促す |

### システムエラー
| エラー種別 | 表示メッセージ | 対応 |
|-----------|---------------|-----|
| 更新競合 | 「他のユーザーが同時に更新しています」 | 最新データ再読込 |
| データベースエラー | 「書誌情報の保存に失敗しました」 | 再試行促す |
| 権限エラー | 「この書誌を編集する権限がありません」 | 権限確認促す |