# BF008: 貸出処理

## 概要
利用者が図書館内の利用者向け端末を使用して、セルフサービスで書籍貸出を行う業務フロー

## アクター
- **利用者**: 図書館会員

## 前提条件
- 利用者が図書館会員として登録済み
- 貸出希望書籍が利用可能状態

## 業務フロー

```mermaid
flowchart TD
    subgraph "利用者"
        A[図書館に来館]
        B[貸出希望書籍を持参]
        C[SU01: 利用者向け端末で認証]
        D[SU06: 貸出処理画面を開く]
        E[書籍バーコードをスキャン]
        F[SU07: 貸出確認画面で確認]
        G[貸出処理を実行]
        H[SU08: 貸出完了画面を確認]
        I[貸出書籍を受領]
    end
    
    subgraph "システム"
        J[会員情報を表示]
        K{利用者ステータス確認}
        L[書籍情報を表示]
        M{貸出可能判定}
        N[貸出レコード作成]
        O[返却期限を算出]
        P[書籍ステータス更新]
        Q[利用制限の理由表示]
        R[貸出不可理由の表示]
    end
    
    A --> B
    B --> C
    C --> J
    J --> K
    K -->|利用可能| D
    K -->|利用制限中| Q
    D --> E
    E --> L
    L --> M
    M -->|貸出可能| F
    M -->|貸出不可| R
    F --> G
    G --> N
    N --> O
    O --> P
    P --> H
    H --> I
```

## 利用者ステータス確認
1. **利用可能**: 正常な会員状態
2. **延滞中**: 返却期限を過ぎた書籍がある
3. **利用停止**: 長期延滞、弁償未完了等
4. **会員期限切れ**: 会員更新が必要

## 貸出可能判定
1. **書籍状態**: 貸出可能、修理中、紛失等
2. **貸出上限**: 個人10冊、団体20冊まで
3. **予約状況**: 他の利用者の予約有無
4. **特殊資料**: 貸出禁止資料の確認

## 返却期限算出
- **一般書籍**: 2週間
- **雑誌**: 1週間
- **DVD/CD**: 1週間
- **祝日調整**: 返却日が休館日の場合は翌開館日

## 成果物
- 貸出レコード（貸出テーブル）
- 書籍ステータス更新（蔵書テーブル）
- 貸出レシート（物理）

## 後続フロー
- [BF009: 返却処理](BF009_返却処理.md)
- [BF010: 貸出延長](BF010_貸出延長.md)

## 例外処理
- **会員カード忘れ**: 会員IDとパスワードでの認証
- **書籍バーコード読み取り不可**: 手入力またはISBN入力
- **システムエラー**: エラーメッセージ表示、スタッフへの連絡案内
- **利用制限中**: 制限理由の表示、スタッフカウンターへの案内

## 注意事項
- 利用者は貸出前に書籍の状態を確認
- システムが返却期限と注意事項を画面に表示
- 特殊資料（貴重書等）はセルフ貸出対象外、スタッフカウンターで手続き
- 貸出上限に達している場合は返却後の再貸出を画面で案内