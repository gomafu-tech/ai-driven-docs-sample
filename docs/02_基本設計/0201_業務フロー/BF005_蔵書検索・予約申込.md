# BF005: 蔵書検索・予約申込

## 概要
利用者がオンラインで蔵書を検索し、予約可能な書籍を予約申込する業務フロー

## アクター
- **利用者**: 図書館会員

## 前提条件
- 利用者が図書館会員として登録済み
- 利用者がオンラインシステムにログイン済み

## 業務フロー

```mermaid
flowchart TD
    subgraph "利用者"
        A[SU03: 蔵書検索画面にアクセス]
        B[検索条件を入力]
        C[検索実行]
        D[検索結果を確認]
        E{予約したい書籍の選択}
        F[SU13: 予約申込画面にアクセス]
        G[予約理由・受取希望館を選択]
        H[予約申込を送信]
    end
    
    subgraph "システム"
        I[蔵書データベースを検索]
        J[検索結果を表示]
        K{書籍の利用可能性確認}
        L[予約申込を受付]
        M[予約番号を採番]
        N[利用者に予約完了通知]
        O[スタッフに予約通知]
    end
    
    A --> B
    B --> C
    C --> I
    I --> J
    J --> D
    D --> E
    E -->|予約する| F
    E -->|予約しない| A
    F --> G
    G --> H
    H --> K
    K -->|予約可能| L
    K -->|予約不可| J
    L --> M
    M --> N
    N --> O
```

## 検索条件
1. **基本検索**: タイトル、著者名、ISBN等での検索
2. **詳細検索**: 出版年、分類、出版社等を組み合わせた検索
3. **絞り込み**: 利用可能状況、資料形態等による絞り込み

## 予約可能判定
1. **利用可能**: 書庫にあり即座に貸出可能
2. **予約可能**: 貸出中だが予約可能
3. **予約不可**: 修理中、紛失等で予約不可
4. **予約上限**: 利用者の予約上限数に達している

## 成果物
- 検索履歴レコード（検索履歴テーブル）
- 予約申込レコード（予約テーブル）
- 予約通知メール

## 後続フロー
- [BF007: 予約取置・貸出](BF007_予約取置・貸出.md)

## 例外処理
- **システムエラー**: エラーメッセージ表示、後日再試行案内
- **ログインセッション切れ**: 再ログイン案内
- **予約上限超過**: 既存予約の確認・キャンセル案内

## 注意事項
- 予約は1会員につき最大10冊まで
- 予約の有効期限は申込から30日間
- 人気書籍は予約待ちが発生する可能性がある