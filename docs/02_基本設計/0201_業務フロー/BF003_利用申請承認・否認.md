# BF003: 利用申請承認・否認

## 概要
スタッフが提出された利用申請を審査し、承認または否認の判定を行う業務フロー

## アクター
- **スタッフ**: 図書館職員（申請審査権限あり）

## 前提条件
- 利用申請が提出済み（BF001またはBF002完了）
- 申請内容と証明書の事前確認が完了している

## 業務フロー

```mermaid
flowchart TD
    subgraph "スタッフ"
        A[SS03: 利用申請一覧画面を表示]
        B[未審査の申請を選択]
        C[SS04: 利用申請詳細画面を表示]
        D[申請内容を詳細確認]
        E[アップロードされた証明書を確認]
        F{審査判定}
        G[SS05: 利用申請承認画面]
        H[SS05: 利用申請否認画面]
        I[承認理由を記入（任意）]
        J[承認処理を実行]
        W[否認理由を記入（必須）]
        X[否認処理を実行]
    end
    
    subgraph "システム"
        K[利用申請承認レコード作成]
        L[会員テーブルに新規登録]
        M{会員種別判定}
        N[個人会員テーブルに詳細情報登録]
        O[団体会員テーブルに詳細情報登録]
        P[会員カードテーブルに登録]
        Q[会員カード作成]
        R[申請者に承認通知メール送信]
        S[カード受取待ちステータス]
        T[利用申請否認レコード作成]
        U[申請者に否認通知メール送信]
        V[申請処理完了]
    end
    
    A --> B
    B --> C
    C --> D
    D --> E
    E --> F
    F -->|承認| G
    F -->|否認| H
    G --> I
    I --> J
    J --> K
    K --> L
    L --> M
    M -->|個人会員| N
    M -->|団体会員| O
    N --> P
    O --> P
    P --> Q
    Q --> R
    R --> S
    H --> W
    W --> X
    X --> T
    T --> U
    U --> V
```

## 審査基準

### 承認条件
1. **本人確認**: 提出された身分証明書が有効
2. **申請内容の妥当性**: 記載内容に虚偽がない
3. **利用資格**: 図書館利用規約に違反していない
4. **過去の利用履歴**: 利用停止履歴等がない（既存データベース確認）

### 否認条件
1. **証明書不備**: 身分証明書が無効または不鮮明
2. **申請内容不備**: 必須項目の未記入や虚偽記載
3. **利用資格なし**: 年齢制限、地域制限等に該当
4. **過去のトラブル**: 延滞常習、破損等の履歴あり

## 成果物

### 承認の場合
- 利用申請承認レコード（利用申請承認テーブル）
- 会員レコード（会員テーブル）
- 個人会員レコード（個人会員テーブル）または団体会員レコード（団体会員テーブル）
- 会員カードレコード（会員カードテーブル）
- 物理的な会員カード作成
- 承認通知メール

### 否認の場合
- 利用申請否認レコード（利用申請否認テーブル）
- 利用申請イベントレコード（ステータス: 否認）
- 否認通知メール（否認理由含む）

## 後続フロー

### 承認の場合
- [BF004: 会員カード交付](BF004_会員カード交付.md)

### 否認の場合
- 申請処理終了（再申請は新規申請として扱う）